---
vcsPath: classifieds/docs/tech/principles/crosservice-development.md
title: Принципы кроссервисной разработки
---

## Abstract

Вертикали обладают сложной и гетерогенной инфраструктурой, разные части которой находятся во владении разных команд. Зачастую для решения задачи требуется внести правки в более чем один сервис, в том числе и в те, которыми владеют другие команды.

## Цель

Упростить внесение изменений и повысить качество принимаемых технических решений.

## Правила внесения изменений в чужую кодовую базу

### Перед внесением изменений

Почитай документацию, ознакомься с coding standards, дойди до владельца со своей задачей и обсуди варианты решения, **получи одобрение от владельца**. Если изменений много - возможно стоит использовать
 Процедуру design review. 

### Feel free to contribute

Можно вносить правки в любой сервис. Но при этом:
  - правки должны соответствовать code style, coding standarts и архитектурным принципам, принятым в команде - владельце кода; '*
  - перед тем, как отдать правки на ревью владельцу, дай их посмотреть своим коллегам;
  - нельзя вливать правки без согласия владельца;
  - оставь код лучше, чем он был до твоего прихода;
  - как контрибьютор не забывай, что межкомандное ревью может занять дольше, чем обычно;

'* - а что если нет coding style, coding standarts? Смотри "Я - владелец".

### Тесты

Тесты важны. У нас green trunk и trunk based development, и тесты - это один из механизмов, который позволяет рассчитывать на то, что сделанные правки не сломали функциональность сервиса. Но не только. Тесты - это еще и часть документации проекта. А потому:
  - написал новый код - обложи его тестами;
  - внес правки и сломал тесты? - почини;
  - внес правки, а тесты не упали? Возможно они написаны криво или их недостаточно. Удостоверься, что для твоих правок тесты проходят корректно;
  - нашел ненужные тесты - удали;

### Эксплуатация

Не забывай что решение задачи это не только написание кода, но и эксплуатация. Подумай о метриках, логах, мониторингах, трассировке. Не усложняй жизнь тех, кто будет поддерживать сервис в production окружении.

### Кто сломал - тот и чинит

Ни что в мире не может гарантировать то, что написанный код корректен (окей, может быть кроме TLA+). И потому внесенные правки могут сломать тесты, метрики, и даже production.
Чинить в таком случае должен автор правок.
*Важно!* если результатом правок стал инцидент - его устраняет команда, ответственная за эксплуатацию сломанного сервиса. Она не делегирует починку автору ломающих правок. Но дальше можно завести баг и передать его автору, чтобы он его исправил.


## Что должен обеспечить владелец кода

### Code review:

Code review очень важная часть процесса разработки. Оно преследует две основные цели: поддержание качества технических решений на должном уровне и обмен информацией. Но, зачастую, добавляет не мало сложностей в процесс разработки. Чтобы сделать этот процесс не таким болезненным и более прозрачным - нужно иметь сформулированные политики code review:

  - как назначаем ревьюеров;
  - каков SLA на просмотр PR (базовая рекомендация - смотрим не позже чем на следующий день);
  - принципы проведения PR;

Если говорить про принципы, то базовые принципы, от которых стоит отстраиваться такие:

  - мы даем развернутые объяснения к оставленным замечаниям: почему, что будет если не исправить, как сделать правильно. Такой подход здорово экономит время как ревьюера, так и автора кода сокращая количество пинг-понгов;
  - мы не отсматриваем то, что можно проверить автоматически;
  - если дискуссия принимает идеологический характер, то надо мёржить PR и продолжать холивар уже после решённой задачи;
  - отталкиваться от соглашений. Если в организации существует правило, как надо писать код в определённых ситуациях, на код-ревью надо отталкиваться от этого правила. Если же правила нет, то валидным считается любой стиль кодирования в разумных пределах, а после решения задачи можно обсудить формулирования общего правила;


### Инструментарий для поддержания качества кодовой базы:


#### Code style

Code style необходим, без него неизбежны бесконечные споры об именовании переменных, отступах и комментариях.
Нет ни малейшего смысла проверять code style в PR. Это рутинная деятелельность и она должна быть автоматизирована.
Потому необходимо, чтобы у каждого проекта был определен code style и он должен проверяться линтерами, которые легко запустить локально, и которые автоматически запускаются на PR. Вообще - все что может проверяться автоматически - должно проверяться автоматически.
Если есть возможность - неплохо использовать автоформаттер.

#### Coding standards

**Зачем нужны?**
  - проще интегрировать людей в команды;
  - легче поддерживать качество кода;
  - экономия времени на code review;
  - код проще, разработка быстрее;

**Что в них может быть:**
  - структура проекта (папочки/пакеты, где пишем бизнес логику);
  - как мы пишем функции / классы
  - как мы пишем тесты


#### Тестирование

Тестирование - это очень важно. Тесты это надежность, это скорость обратной связи, это документация проекта. Они должны быть:
  - простыми для написания; тесты должно быть легко писать - иначе их писать не будут;
  - простыми для выполнения; тесты должно быть легко запустить;
  - простыми в поддержке; если тест ломается - должно быть понятно почему и как его быстро починить;
  - надежными; если твой код сломали, ты должен это узнать;
  - понятными; владельцы кода должны понимать - что тестируют те или иные тесты и зачем;
  - [optional] покрытие кода; правки кода не должны приводить к снижению покрытия;
